{# app/partials/special_preview.html #}
{% load static %}
{% load extras %}
  <div class="row g-4 align-items-start">

    <!-- LEFT COLUMN: Widget -->
    <div class="col-lg-5">
      <div class="card widget-frame border-ink-800 shadow-sm">
        <div class="card-body">
          <div id="appertivo-preview"></div>

          <script>
            // Configure BEFORE loading the widget script
            window.appertivoConfig = {
              mount: '#appertivo-preview',   // where to render inline
              inline: true,                  // render inside the div, not floating
              openOnLoad: true               // show as if clicked
              // optional: inlineWidth: '100%', inlineMaxWidth: '520px'
            };
          </script>
          <script src="http://127.0.0.1:8000/appertivo-widget.js?restaurant=13&special={{ special.pk }}"></script>
        </div>
      </div>
    </div>

    <!-- RIGHT COLUMN: Form Preview -->
    <div class="col-lg-7">
      <div class="card border-0 shadow-sm">
        <div class="card-body">
          
      {# Title (inline) #}
      <div id="field-title-{{ special.id }}" class="d-flex align-items-start justify-content-between">
        <h3 class="h5 mb-1">{{ special.title|default:"(No title)" }}</h3>
        <button class="btn btn-link btn-sm"
                hx-get="{% url 'special_edit_field' special.id 'title' %}"
                hx-target="#field-title-{{ special.id }}"
                hx-swap="outerHTML">Edit</button>
      </div>

      {# Description (inline) #}
      <div id="field-description-{{ special.id }}" class="mb-2">
        <p class="mb-2 text-secondary">{{ special.description|linebreaks|default:"(No description)" }}</p>
        <button class="btn btn-link btn-sm"
                hx-get="{% url 'special_edit_field' special.id 'description' %}"
                hx-target="#field-description-{{ special.id }}"
                hx-swap="outerHTML">Edit</button>
      </div>

      {# CTA buttons reflect current URLs #}
      <div class="d-flex flex-wrap gap-2 mb-2">
        {% if special.order_url %}
          <a href="{{ special.order_url }}" target="_blank" class="btn btn-teal">Order</a>
        {% endif %}
        {% if special.mobile_order_url %}
          <a href="{{ special.mobile_order_url }}" target="_blank" class="btn btn-purple">Mobile</a>
        {% endif %}
        {% if special.phone_number %}
          <a href="tel:{{ special.phone_number }}" class="btn btn-orange">Call</a>
        {% endif %}
      </div>

      {# URL/phone editors #}
      <div class="row g-2">
        <div id="field-order_url-{{ special.id }}" class="col-12 col-md-6">
          <div class="small text-muted">Order URL</div>
          <div class="d-flex align-items-center justify-content-between">
            <div class="text-truncate">{{ special.order_url|default:"—" }}</div>
            <button class="btn btn-link btn-sm"
                    hx-get="{% url 'special_edit_field' special.id 'order_url' %}"
                    hx-target="#field-order_url-{{ special.id }}"
                    hx-swap="outerHTML">Edit</button>
          </div>
        </div>

        <div id="field-mobile_order_url-{{ special.id }}" class="col-12 col-md-6">
          <div class="small text-muted">Mobile order URL</div>
          <div class="d-flex align-items-center justify-content-between">
            <div class="text-truncate">{{ special.mobile_order_url|default:"—" }}</div>
            <button class="btn btn-link btn-sm"
                    hx-get="{% url 'special_edit_field' special.id 'mobile_order_url' %}"
                    hx-target="#field-mobile_order_url-{{ special.id }}"
                    hx-swap="outerHTML">Edit</button>
          </div>
        </div>

        <div id="field-phone_number-{{ special.id }}" class="col-12 col-md-6">
          <div class="small text-muted">Phone</div>
          <div class="d-flex align-items-center justify-content-between">
            <div>{{ special.phone_number|default:"—" }}</div>
            <button class="btn btn-link btn-sm"
                    hx-get="{% url 'special_edit_field' special.id 'phone_number' %}"
                    hx-target="#field-phone_number-{{ special.id }}"
                    hx-swap="outerHTML">Edit</button>
          </div>
        </div>
      </div>

      {# Dates (inline) #}
      <div class="mt-2">
        <div id="field-start_date-{{ special.id }}" class="d-inline-block me-3">
          <span class="small text-muted">Starts</span>
          <span>{{ special.start_date|date:"Y-m-d"|default:"—" }}</span>
          <button class="btn btn-link btn-sm p-0 ms-2"
                  hx-get="{% url 'special_edit_field' special.id 'start_date' %}"
                  hx-target="#field-start_date-{{ special.id }}"
                  hx-swap="outerHTML">Edit</button>
        </div>

        <div id="field-end_date-{{ special.id }}" class="d-inline-block">
          <span class="small text-muted">Ends</span>
          <span>{{ special.end_date|date:"Y-m-d"|default:"—" }}</span>
          <button class="btn btn-link btn-sm p-0 ms-2"
                  hx-get="{% url 'special_edit_field' special.id 'end_date' %}"
                  hx-target="#field-end_date-{{ special.id }}"
                  hx-swap="outerHTML">Edit</button>
        </div>
        </div>
      </div>
    </div>

  </div>
</div>
